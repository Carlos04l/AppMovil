<!DOCTYPE html>
<html>
<head>
    <title>Matriz de Riesgos</title>
    <style>
        body {
            font-family: Arial;
            margin: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 15px;
        }

        table, th, td {
            border: 1px solid #666;
            padding: 8px;
        }

        th {
            background: #eee;
        }

        .msg {
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .success { background: #c8f7c5; }
        .error   { background: #f7c5c5; }
    </style>
</head>
<body>

<h1>Matriz de Riesgos</h1>

<!-- Mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="msg {{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}

<!-- Formulario -->
<form method="POST" action="{{ url_for('riesgos_agregar') }}">

    <input type="text" name="riesgo" placeholder="Descripción del riesgo" required>

    <select name="probabilidad">
        <option>Alta</option>
        <option>Media</option>
        <option>Baja</option>
    </select>

    <select name="impacto">
        <option>Alto</option>
        <option>Medio</option>
        <option>Bajo</option>
    </select>

    <input type="text" name="mitigacion" placeholder="Medidas de mitigación" required>

    <button type="submit">Guardar riesgo</button>
</form>

<hr>

<h2>Lista de riesgos registrados</h2>

<table>
    <tr>
        <th>ID</th>
        <th>Riesgo</th>
        <th>Probabilidad</th>
        <th>Impacto</th>
        <th>Nivel</th>
        <th>Mitigación</th>
        <th>Creado por</th>
        <th>Acciones</th>
    </tr>

    {% for r in riesgos %}

    {% set nivel = '' %}
    {% if r.probabilidad == 'Alta' and r.impacto == 'Alto' %}
        {% set nivel = 'Crítico' %}
    {% elif r.probabilidad == 'Alta' or r.impacto == 'Alto' %}
        {% set nivel = 'Alto' %}
    {% elif r.probabilidad == 'Media' and r.impacto == 'Medio' %}
        {% set nivel = 'Medio' %}
    {% else %}
        {% set nivel = 'Bajo' %}
    {% endif %}

    <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.riesgo }}</td>
        <td>{{ r.probabilidad }}</td>
        <td>{{ r.impacto }}</td>
        <td>{{ nivel }}</td>
        <td>{{ r.mitigacion }}</td>
        <td>{{ r.creado_por }}</td>

        <td>
            <a href="{{ url_for('riesgos_editar_form', id=r.id) }}">Editar</a>
            |
            <form method="POST" action="{{ url_for('riesgos_eliminar', id=r.id) }}" style="display:inline;">
                <button type="submit">Eliminar</button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>

</body>
</html>
